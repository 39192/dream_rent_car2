const compactChargeSet = {basic: 37, zdc: 17}, // 컴팩트 5인
  midSize2ChargeSet = {basic: 41, zdc: 22}, // 미드사이즈
  suvChargeSet = {basic: 50, zdc: 22}, // SUV 5인
  eightVanChargeSet = {basic: 80, zdc: 27},
  chargeSet = {
    compact: compactChargeSet,
    midSize2: midSize2ChargeSet,
    suv: suvChargeSet,
    eightVan: eightVanChargeSet,
  };

function addDays(e, t) {
  return new Date(e.getTime() + 864e5 * t);
}

function refreshFromChangeTime() {
  if (getRentDays() < 1) {
    alert("렌트 기간은 1일부터 가능합니다.");
    var e = addDays(new Date($("#pickup-date").val()), 1);
    $(".input-group.date.return-date").datepicker("setDate", e);
    $("#return-time").val($("#pickup-time").val());
  }
  refresh();
}

function initializeDatePicker() {
  $(".input-group.date.pickup-date").datepicker({
    calendarWeeks: false,
    todayHighlight: true,
    keyboardNavigation: false,
    autoclose: true,
    format: "yyyy-mm-dd",
    language: "kr",
    startDate: new Date(addDays(new Date(), 0))
  }),
    $(".input-group.date.return-date").datepicker({
      calendarWeeks: false,
      todayHighlight: true,
      keyboardNavigation: false,
      autoclose: true,
      format: "yyyy-mm-dd",
      language: "kr",
      startDate: new Date(addDays(new Date(), 1))
    }),
    $(".input-group.date.pickup-date").datepicker("setDate",
      addDays(new Date(), 0)),
    $(".input-group.date.return-date").datepicker("setDate",
      addDays(new Date(), 1));
}

function initializeTimeComboBox() {
  for (let e = 8; e <= 18; e++) {
    let t = e === 10 ? "selected" : "",
      a = (e < 10 ? "0" : "") + e + ":00";
    $("#pickup-time").append(
      "<option value=" + a + " " + t + ">" + a + "</option>");
    if (e < 24) {
      let r = (e < 10 ? "0" : "") + e + ":30";
      $("#pickup-time").append("<option value=" + r + ">" + r + "</option>");
    }
  }
  for (let i = 0; i <= 2; i++) {
    let n = (i < 10 ? "0" : "") + i + ":00";
    $("#return-time").append("<option value=" + n + ">" + n + "</option>");
    if (i < 24) {
      let o = (i < 10 ? "0" : "") + i + ":30";
      $("#return-time").append("<option value=" + o + ">" + o + "</option>");
    }
  }
  for (let c = 8; c <= 23; c++) {
    let u = c === 10 ? "selected" : "",
      l = (c < 10 ? "0" : "") + c + ":00";
    $("#return-time").append(
      "<option value=" + l + " " + u + ">" + l + "</option>");
    if (c < 24) {
      let d = (c < 10 ? "0" : "") + c + ":30";
      $("#return-time").append("<option value=" + d + ">" + d + "</option>");
    }
  }
}

function refresh() {
  setRentDays();
  processAboutAllChargesOf("compact");
  processAboutAllChargesOf("midSize2");
  processAboutAllChargesOf("suv");
  processAboutAllChargesOf("eightVan");
}

function setRentDays() {
  let e = getAdditionalHour(),
    t = Math.floor(e),
    a = (e - Math.floor(e)) * 60;
  $("#rentDays").html(
    getRentDays() +
    " 일" +
    (e > 0 && e < 7
      ? " + " + (t > 0 ? t + " 시간 " : "") + (a > 0 ? a + " 분" : "")
      : "")
  );
}

function processAboutAllChargesOf(e) {
  let t = getReservationCharge(),
    a = getBasicCharge(e),
    r = a + getZDCCharge(e);
  $("#" + e + "-basic-below-three-days").text(convertDollarText(a)),
    $("#" + e + "-basic-reservation").text(convertDollarText(t)),
    $("#" + e + "-basic-office").text(convertDollarText(a - t)),
    $("#" + e + "-zdc-below-three-days").text(convertDollarText(r)),
    $("#" + e + "-zdc-reservation").text(convertDollarText(t)),
    $("#" + e + "-zdc-office").text(convertDollarText(r - t));
}

function getBasicCharge(e) {
  let t = chargeSet[e].basic;
  if (getRentDays() > 3) {
    if (e === "compact") {
      t = 35;
    } else if (e === "midSize2") {
      t = 39;
    }
  }
  return t * getRentDays() + getAdditionalTimeCharge(t);
}

function getRentDays() {
  let totalDays = getDiffPickupDateAndReturnDate();
  let additionalHours = getAdditionalHour();

  if (additionalHours > 1) {
    totalDays += 1;
  } else if (additionalHours >= 0.5) {
    totalDays += 0.5;
  }

  return totalDays;
}

function getDiffPickupDateAndReturnDate() {
  let e = new Date($("#pickup-date").val());
  return (new Date($("#return-date").val()) - e) / 864e5;
}

function getReservationCharge() {
  return 10 * Math.ceil(getRentDays());
}

function getZDCCharge(e) {
  let t = Math.ceil(
    getDiffPickupDateAndReturnDate() + getAdditionalDayZDCCharge());
  return chargeSet[e].zdc * t;
}

function getAdditionalDayZDCCharge() {
  return 0;
}

function getAdditionalTimeCharge(e) {
  let t = getAdditionalHour();
  return t > 0 && t < 1 ? 8 : 0;
}

function getAdditionalDayCharge() {
  return 0;
}

function getAdditionalHour() {
  let e = Number($("#return-time").val().split(":")[0]) - Number(
      $("#pickup-time").val().split(":")[0]),
    t = Number($("#return-time").val().split(":")[1]) - Number(
      $("#pickup-time").val().split(":")[1]);
  return (e > 0 ? e : 0) + (e >= 0 && t > 0 ? t / 60 : 0);
}

function convertDollarText(e) {
  return "$" + Number(e).toFixed(1);
}

$(document).ready(function () {
  initializeDatePicker();
  initializeTimeComboBox();
  $(".input-group.date.pickup-date").on("change", function () {
    gtag("event", "change_pickup_date",
      {event_category: "guamfree_calculator"});
    var e = addDays(new Date($("#pickup-date").val()), 1);
    $(".input-group.date.return-date").datepicker("setDate", e);
    $("#return-time").val($("#pickup-time").val());
    refresh();
  });
  $(".input-group.date.return-date").on("change", function () {
    if (getDiffPickupDateAndReturnDate() <= 0) {
      alert("렌트 기간은 1일부터 가능합니다.");
      var e = addDays(new Date($("#pickup-date").val()), 1);
      $(".input-group.date.return-date").datepicker("setDate", e);
      $("#return-time").val($("#pickup-time").val());
    }
    refresh();
  });
  $("#pickup-time").change(function () {
    gtag("event", "change_pickup_time",
      {event_category: "guamfree_calculator"});
    refreshFromChangeTime();
  });
  $("#return-time").change(function () {
    gtag("event", "change_return_time",
      {event_category: "guamfree_calculator"});
    refreshFromChangeTime();
  });
  refresh();
});
